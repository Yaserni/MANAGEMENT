pipeline {

  agent {

    docker {

      image 'windsekirun/jenkins-android-docker:1.1.1'

    }

  }

  options {

    // Stop the build early in case of compile or test failures

    skipStagesAfterUnstable()

  }

  stages {

    stage ('Prepare'){

      steps {

        sh 'chmod +x ./gradlew'

      }

    }

    stage('Compile') {

      steps {

        // Compile the app and its dependencies

        sh './gradlew compileDebugSources'

      }

    }

    stage('Build APK') {

      steps {

        // Finish building and packaging the APK

        sh './gradlew assembleDebug'

      }

    }

  }
post {
		always {
            echo 'Finishing up'
            deleteDir() /* clean up our workspace */
        }
failure {
        	 mail to: 'yaserni@ac.sce.ac.il',
             subject: "Failed Pipeline: ${currentBuild.fullDisplayName}",
             body: "Something is wrong with ${env.BUILD_URL} "
} 
   }
}