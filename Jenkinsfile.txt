pipeline {

  agent {

    docker {

      image 'windsekirun/jenkins-android-docker:1.1.1'

    }

  }

  options {

       skipStagesAfterUnstable()

  }

  stages {

    stage ('Prepare'){

      steps {

        sh 'chmod +x ./gradlew'

      }

    }

    stage('Compile') {

      steps {

        sh './gradlew compileDebugSources'

      }

    }

 
  stage('Unit test') {

    
               sh './gradlew testDebugUnitTest' 
                junit '**/TEST-*.xml'
                }
            }

   

    stage('Build APK') {

      steps {
      
        sh './gradlew assembleDebug'

      }

    }

  }
  
   post {


    failure {

      // Notify developer team of the failure

      mail to: 'yaserni@ac.sce.ac.il', subject: 'Oops!', body: "Build ${env.BUILD_NUMBER} failed; ${env.BUILD_URL}"
    }
    success {

          // Notify if the upload succeeded

          mail to: 'yaserni@ac.sce.ac.il', subject: 'New build available!', body: "Build ${env.BUILD_NUMBER} Check it out! Enter the link :  ${env.BUILD_URL}"

        }
  }

}
